TODO
* Fix extends for elements. Currently , we use index, but we should map by name.
* Lots more...
